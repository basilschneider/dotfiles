#!/usr/bin/env bash

# Sometimes, ls or ll are predefined as alias
unalias ls 2>/dev/null
unalias ll 2>/dev/null
unalias la 2>/dev/null
oldls(){
    /bin/ls --color=auto "${@}"
}
oldll(){
    oldls -l "${@}"
}
oldla(){
    oldls -a "${@}"
}
oldlla(){
    oldls -la "${@}"
}
ls(){
    # Use exa if installed, otherwise fall back to ls
    if command -v exa &>/dev/null; then
        exa "${@}"
    else
        oldls "${@}"
    fi
}
ll(){
    ls -l "${@}"
}
la(){
    ls -a "${@}"
}
lla(){
    ls -la "${@}"
}
grep(){
    command grep --color=auto "${@}"
}
egrep(){
    command egrep --color=auto "${@}"
}
less(){
    command less -N "${@}"
}
diff(){
    command diff -u "${@}"
}

#rgrep(){
#    local pattern="${1:-pattern}"
#    shift 1
#    grep \
#        -Ir \
#        --exclude-dir=.svn \
#        --exclude-dir=.git \
#        --exclude-dir=InstallArea \
#        --exclude-dir=WorkArea \
#        --exclude=\*.make \
#        --exclude=\*.d \
#        --exclude=\*.asetup\* \
#        --exclude=.Session.vim \
#        --exclude=build.out \
#        --exclude=tags \
#        --exclude=cscope.out \
#        "${pattern}" "$@"
#}

mkcd(){
    mkdir "${1}" && cd "${1}"
}

# Always exec startx, so if the GUI crashes, the terminal exits
sx(){
    exec startx "${@}"
}

# My favourite format for date (used for the logs)
mydate(){
    date +"%F_%H-%M-%S"
}
export mydate

# Always show Monday as first day of the week in cal
cal(){
    command cal -m "${@}"
}

# Function that checkes if an element is in an array
# Usage: contains "${arr1[@]}" "${arr2[@]}" element
# Returns true when element is in arr1 or arr2, otherwise returns false
contains(){
    # Number of arguments
    local n=$#
    # Value of element to be searched
    local value=${!n}
    # Loop over arrays (but not over element (last positional argument))
    for ((i=1;i < $#;i++)){
        if [ "${!i}" == "${value}" ]; then
            echo "true"
            return 0
        fi
    }
    echo "false"
    return 1
}

# Voms alias with long validity
voms(){
    voms-proxy-init -voms cms --valid 168:00
}

mocp(){
    mocp-scrobbler.py -d; /usr/bin/mocp "${@}"
}

# Setup latest LaTeX distribution on lxplus
lxplusLatex(){
    export PATH=/afs/cern.ch/sw/XML/texlive/latest/bin/x86_64-linux:$PATH
}

# Setup CMSSW
cmssw(){
    . /cvmfs/cms.cern.ch/cmsset_default.sh
}

# Setup CRAB3
crab3(){
    . /cvmfs/cms.cern.ch/crab3/crab.sh
}

# On lxplus, send job to background that renews kerberos ticket before it
# expires
renewKerberos(){
    (
        echo Process to automatically renew kerberos ticket before it expires
        echo sent to background
        while true; do
            sleep 77777
            kinit -R
            aklog -c CERN.CH
        done
    ) &
}
