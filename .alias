#!/usr/bin/env bash

# Sometimes, ls or ll are predefined as alias
unalias ls 2>/dev/null
unalias ll 2>/dev/null
ls(){
    /bin/ls --color=auto "${@}"
}
ll(){
    ls -l "${@}"
}
la(){
    ls -a "${@}"
}
lla(){
    ls -la "${@}"
}
grep(){
    /bin/grep --color=auto "${@}"
}
egrep(){
    /bin/egrep --color=auto "${@}"
}
less(){
    /usr/bin/less -N "${@}"
}
diff(){
    /usr/bin/diff -u "${@}"
}

rgrep(){
    local pattern="${1:-pattern}"
    shift 1
    grep \
        -Ir \
        --exclude-dir=.svn \
        --exclude-dir=.git \
        --exclude-dir=InstallArea \
        --exclude-dir=WorkArea \
        --exclude=*.make \
        --exclude=*.d \
        --exclude=*.asetup* \
        --exclude=.Session.vim \
        --exclude=build.out \
        --exclude=tags \
        --exclude=cscope.out \
        "${pattern}" "$@"
}

mkcd(){
    mkdir "${1}" && cd "${1}"
}

# Always exec startx, so if the GUI crashes, the terminal exits
sx(){
    exec startx "${@}"
}

# Start keepass with my kdb file
mykeepass(){
    keepass ~/Documents/keepass/all.kdbx "${@}"
}

# My favourite format for date (used for the logs)
mydate(){
    date +"%F_%H-%M-%S"
}
export -f mydate

# Always show Monday as first day of the week in cal
cal(){
    /usr/bin/cal -m "${@}"
}

# Function that checkes if an element is in an array
# Usage: contains "${arr1[@]}" "${arr2[@]}" element
# Returns true when element is in arr1 or arr2, otherwise returns false
contains(){
    # Number of arguments
    local n=$#
    # Value of element to be searched
    local value=${!n}
    # Loop over arrays (but not over element (last positional argument))
    for ((i=1;i < $#;i++)){
        if [ "${!i}" == "${value}" ]; then
            echo "true"
            return 0
        fi
    }
    echo "false"
    return 1
}

eosSetup(){
    . /afs/cern.ch/project/eos/installation/atlas/etc/setup.sh
}
export -f eosSetup

# Voms alias with long validity
voms(){
    voms-proxy-init -voms cms --valid 96:00
}

mocp(){
    mocp-scrobbler.py -d; /usr/bin/mocp "${@}"
}

# not working on lxplus, probably due to old version of tput
nowrap(){
    (tput rmam;
     "${@}";
     tput smam)
}

# Setup latest LaTeX distribution on lxplus
lxplusLatex(){
    export PATH=/afs/cern.ch/sw/XML/texlive/latest/bin/x86_64-linux:$PATH
}

# Setup CMSSW
cmssw(){
    . /cvmfs/cms.cern.ch/cmsset_default.sh
    export SCRAM_ARCH=slc6_amd64_gcc491
}
